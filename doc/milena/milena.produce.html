<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>milena.produce documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Milena</span> <span class="project-version">0.0.0-alpha8</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>milena</span></div></div></li><li class="depth-2 branch"><a href="milena.admin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>admin</span></div></a></li><li class="depth-2 branch"><a href="milena.consume.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>consume</span></div></a></li><li class="depth-2 branch"><a href="milena.deserialize.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>deserialize</span></div></a></li><li class="depth-2"><a href="milena.interop.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interop</span></div></a></li><li class="depth-3 branch"><a href="milena.interop.clj.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clj</span></div></a></li><li class="depth-3"><a href="milena.interop.java.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>java</span></div></a></li><li class="depth-2 branch current"><a href="milena.produce.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>produce</span></div></a></li><li class="depth-2"><a href="milena.serialize.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>serialize</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="milena.produce.html#var-close"><div class="inner"><span>close</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-commit"><div class="inner"><span>commit</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-flush"><div class="inner"><span>flush</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-make"><div class="inner"><span>make</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-metrics"><div class="inner"><span>metrics</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-partitions"><div class="inner"><span>partitions</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-producer.3F"><div class="inner"><span>producer?</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">milena.produce</h1><div class="doc"><pre class="plaintext">Everything related to Kafka producers
</pre></div><div class="public anchor" id="var-close"><h3>close</h3><div class="usage"><code>(close producer)</code><code>(close producer timeout-ms)</code></div><div class="doc"><pre class="plaintext">Tries to close the producer cleanly.

Blocks until all sends are done or the optional timeout is elapsed.


@ producer
  Kafka producer.

@ timeout-ms
  Timeout in milliseconds.

=&gt; nil


Throws

  org.apache.kafka.common.errors

    InterruptException
    Whenf the thread is interrupted while blocked.</pre></div></div><div class="public anchor" id="var-commit"><h3>commit</h3><div class="usage"><code>(commit producer record)</code><code>(commit producer record callback)</code></div><div class="doc"><pre class="plaintext">Asynchronously commits a message to Kafka via a producer and calls the optional callback
 on acknowledgment.

 @ producer
   Kafka producer.

 @ record
   Cf. `milena.interop.java/producer-record`

 @ callback
   Cf. `milena.interop.java/callback`

 =&gt; Future resolving to the metadata or throwing if an error occured.
    Cf. `milena.interop.clj/record-metadata`


 Possible exceptions are :

   java.lang

     IllegalStateException
     When a 'transactional.id' has been configured and no transaction has been started.

   org.apache.kafka.common.errors
 
     InterruptException
     When the thread is interrupted while blocked.

     SerializationException
     When the key or value are not valid objects given the configured serializers.

     TimeoutException
     When the time take for fetching metadata or allocating memory for the record has surpassed 'max.block.ms'.

     KafkaException
     Any other unrecoverable error.


Ex. (commit producer
            {:topic "my-topic"
             :key   "some-key"
             :value 42}
            (fn callback [?exception ?meta]
              (when-not ?exception
                (println :committed ?meta))))


Cf. `milena.produce/deref`</pre></div></div><div class="public anchor" id="var-flush"><h3>flush</h3><div class="usage"><code>(flush producer)</code></div><div class="doc"><pre class="plaintext">Flushes the producer.

Sends all buffered messages immediately, even is 'linger.ms' is greater than 0, and blocks until
completion. Other thread can continue sending messages but no garantee is made they will be part
of the flush.


@ producer
  Kafka producer.

=&gt; nil


Throws

  org.apache.kafka.common.errors

    InterruptException
    When the thread is interrupted while flushing.</pre></div></div><div class="public anchor" id="var-make"><h3>make</h3><div class="usage"><code>(make)</code><code>(make {:as ?opts, :keys [?nodes ?config ?serializer ?serializer-key ?serializer-value], :or {?nodes [["localhost" 9092]], ?serializer $.serialize/byte-array, ?serializer-key ?serializer, ?serializer-value ?serializer}})</code></div><div class="doc"><pre class="plaintext">Builds a Kafka producer.

Producers are thread-safe and it is efficient to share one between multiple threads.


@ ?opts
  {:?nodes
    List of [host port].

   :?config
    Kafka configuration map.
    Cf. <a href="https://kafka.apache.org/documentation/#producerconfigs">https://kafka.apache.org/documentation/#producerconfigs</a>
  
   :?serializer
    Kafka serializer or fn eligable for becoming one.
    Cf. `milena.serialize`
        `milena.serialize/make`

   :?serializer-key
    Defaulting to `?serializer`.

   :?serializer-value
    Defaulting to `?deserializer`.}

=&gt; org.apache.kafka.clients.producer.KafkaProducer


Ex. (make {:?nodes            [["some_host" 9092]]
           :?config           {:client.id "my_id"}
           :?serializer-key   milena.serialize/string
           :?serializer-value (fn [_ data]
                                (nippy/freeze data))})</pre></div></div><div class="public anchor" id="var-metrics"><h3>metrics</h3><div class="usage"><code>(metrics producer)</code></div><div class="doc"><pre class="plaintext">Gets metrics about this producer.

@ producer
  Kafka producer.

=&gt; Cf. `milena.interop.clj/metrics`</pre></div></div><div class="public anchor" id="var-partitions"><h3>partitions</h3><div class="usage"><code>(partitions producer topic)</code></div><div class="doc"><pre class="plaintext">Gets a list of partitions for a given topic.

&lt;!&gt; Blocks for ever is the topic doesn't exist and dynamic creation has been disabled.


@ producer
  Kafka producer.

@ topic
  Topic name.

=&gt; List of partitions.
   Cf. `interop.clj/partition-info`


Throws

  org.apache.kafka.common.errors

    WakeupException
    When `unblock` is called before or while this fn is called.

    InterruptException
    When the calling thread is interrupted.</pre></div></div><div class="public anchor" id="var-producer.3F"><h3>producer?</h3><div class="usage"><code>(producer? x)</code></div><div class="doc"><pre class="plaintext">Is this a producer ?
</pre></div></div></div></body></html>