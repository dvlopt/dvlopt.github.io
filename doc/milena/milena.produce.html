<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>milena.produce documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Milena</span> <span class="project-version">0.4.0-alpha3</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>milena</span></div></div></li><li class="depth-2 branch"><a href="milena.admin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>admin</span></div></a></li><li class="depth-2"><a href="milena.analyze.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>analyze</span></div></a></li><li class="depth-3 branch"><a href="milena.analyze.ctx.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ctx</span></div></a></li><li class="depth-3 branch"><a href="milena.analyze.dsl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dsl</span></div></a></li><li class="depth-3 branch"><a href="milena.analyze.stores.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stores</span></div></a></li><li class="depth-3"><a href="milena.analyze.streams.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>streams</span></div></a></li><li class="depth-4"><a href="milena.analyze.streams.grouped.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>grouped</span></div></a></li><li class="depth-3"><a href="milena.analyze.tables.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>tables</span></div></a></li><li class="depth-4"><a href="milena.analyze.tables.grouped.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>grouped</span></div></a></li><li class="depth-3"><a href="milena.analyze.topologies.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>topologies</span></div></a></li><li class="depth-2 branch"><a href="milena.consume.html"><div class="inner"><span class="tree" style="top: -269px;"><span class="top" style="height: 278px;"></span><span class="bottom"></span></span><span>consume</span></div></a></li><li class="depth-2 branch"><a href="milena.deserialize.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>deserialize</span></div></a></li><li class="depth-2"><a href="milena.interop.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interop</span></div></a></li><li class="depth-3 branch"><a href="milena.interop.clj.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clj</span></div></a></li><li class="depth-3"><a href="milena.interop.java.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>java</span></div></a></li><li class="depth-2 branch current"><a href="milena.produce.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>produce</span></div></a></li><li class="depth-2"><a href="milena.serialize.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>serialize</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="milena.produce.html#var-close"><div class="inner"><span>close</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-commit"><div class="inner"><span>commit</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-flush"><div class="inner"><span>flush</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-make"><div class="inner"><span>make</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-metrics"><div class="inner"><span>metrics</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-partitions"><div class="inner"><span>partitions</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-producer.3F"><div class="inner"><span>producer?</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-trx-abort"><div class="inner"><span>trx-abort</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-trx-begin"><div class="inner"><span>trx-begin</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-trx-commit"><div class="inner"><span>trx-commit</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-trx-init"><div class="inner"><span>trx-init</span></div></a></li><li class="depth-1"><a href="milena.produce.html#var-trx-offsets"><div class="inner"><span>trx-offsets</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">milena.produce</h1><div class="doc"><pre class="plaintext">Everything related to Kafka producers.
</pre></div><div class="public anchor" id="var-close"><h3>close</h3><div class="usage"><code>(close producer)</code><code>(close producer timeout-ms)</code></div><div class="doc"><pre class="plaintext">Tries to close the producer cleanly.

Blocks until all sends are done or the optional timeout is elapsed.


@ producer
  Kafka producer.

@ timeout-ms
  Timeout in milliseconds.

=&gt; nil


Throws

  org.apache.kafka.common.errors

    InterruptException
    Whenf the thread is interrupted while blocked.</pre></div></div><div class="public anchor" id="var-commit"><h3>commit</h3><div class="usage"><code>(commit producer record)</code><code>(commit producer record callback)</code></div><div class="doc"><pre class="plaintext">In normal mode, asynchronously commits a message to Kafka via a producer and calls the optional callback
 on acknowledgment or error.

 In transactional mode, behaves synchronously and throws right away in case of failure. When a recoverable error occurs,
 the user should call `trx-abort`. Otherwise, the producer should be closed as it enters a defunct state.

 &lt;!&gt; Callbacks will be executed on the IO thread of the producer, so they should be fast.


 @ producer
   Kafka producer.

 @ record
   Cf. `milena.interop.java/producer-record`

 @ callback
   Cf. `milena.interop.java/callback`

 =&gt; Future resolving to the metadata or throwing if an error occured.
    Cf. `milena.interop.clj/record-metadata`


 Possible exceptions are :

   java.lang

     IllegalStateException
       When a 'transactional.id' has been configured and no transaction has been started.

   org.apache.kafka.common.errors

     AuthenticationException
       When authentication fails.
 
     InterruptException
       When the thread is interrupted while blocked.

     SerializationException
       When the key or value are not valid objects given the configured serializers.

     TimeoutException
       When the time take for fetching metadata or allocating memory for the record has surpassed 'max.block.ms'.

     KafkaException
       Any other unrecoverable error.


  Possibles exceptions in transactions :

    org.apache.kafka.common.errors

     ProducerFencedException (unrecoverable)
       When another producer with the same transaction id is already active.

     OutOfOrderSequenceException (unrecorable)
       When the broker receives an unexpected sequence number from the producer which means that data may have been lost.
       
     UnsupportedVersionException (unrecovarable)
       When the transaction API is not supported by the broker.

     UnsupportedForMessageFormatException (recoverable)
       When the message format of the desination topic is not upgraded to 0.11.0.0.
       


Ex. (commit producer
            {:topic "my-topic"
             :key   "some-key"
             :value 42}
            (fn callback [exception meta]
              (when-not exception
                (println :committed meta))))</pre></div></div><div class="public anchor" id="var-flush"><h3>flush</h3><div class="usage"><code>(flush producer)</code></div><div class="doc"><pre class="plaintext">Flushes the producer.

Sends all buffered messages immediately, even is 'linger.ms' is greater than 0, and blocks until
completion. Other thread can continue sending messages but no garantee is made they will be part
of the flush.


@ producer
  Kafka producer.

=&gt; nil


Throws

  org.apache.kafka.common.errors

    InterruptException
      When the thread is interrupted while flushing.</pre></div></div><div class="public anchor" id="var-make"><h3>make</h3><div class="usage"><code>(make)</code><code>(make {:as opts, :keys [nodes config serializer serializer-key serializer-value], :or {nodes [["localhost" 9092]], serializer M.serialize/byte-array, serializer-key serializer, serializer-value serializer}})</code></div><div class="doc"><pre class="plaintext">Builds a Kafka producer.

Producers are thread-safe and it is efficient to share one between multiple threads.


@ opts (nilable)
  {:nodes (nilable)
    List of [host port].

   :config (nilable)
    Kafka configuration map.
    Cf. <a href="https://kafka.apache.org/documentation/#producerconfigs">https://kafka.apache.org/documentation/#producerconfigs</a>
  
   :serializer (nilable)
    Kafka serializer or fn eligable for becoming one.
    Cf. `milena.serialize`
        `milena.serialize/make`

   :serializer-key (nilable)
    Defaulting to `?serializer`.

   :serializer-value (nilable)
    Defaulting to `?deserializer`.}

=&gt; org.apache.kafka.clients.producer.KafkaProducer


Ex. (make {:nodes            [["some_host" 9092]]
           :config           {:client.id "my_id"}
           :serializer-key   milena.serialize/string
           :serializer-value (fn [_ data]
                               (nippy/freeze data))})</pre></div></div><div class="public anchor" id="var-metrics"><h3>metrics</h3><div class="usage"><code>(metrics producer)</code></div><div class="doc"><pre class="plaintext">Gets metrics about this producer.

@ producer
  Kafka producer.

=&gt; Cf. `milena.interop.clj/metrics`</pre></div></div><div class="public anchor" id="var-partitions"><h3>partitions</h3><div class="usage"><code>(partitions producer topic)</code></div><div class="doc"><pre class="plaintext">Gets a list of partitions for a given topic.

&lt;!&gt; Blocks forever is the topic does not exist and dynamic creation has been disabled.


@ producer
  Kafka producer.

@ topic
  Topic name.

=&gt; List of partitions.
   Cf. `interop.clj/partition-info`


Throws

  org.apache.kafka.common.errors

    WakeupException
      When `unblock` is called before or while this fn is called.

    InterruptException
      When the calling thread is interrupted.</pre></div></div><div class="public anchor" id="var-producer.3F"><h3>producer?</h3><div class="usage"><code>(producer? x)</code></div><div class="doc"><pre class="plaintext">Is `x` a producer ?
</pre></div></div><div class="public anchor" id="var-trx-abort"><h3>trx-abort</h3><div class="usage"><code>(trx-abort producer)</code></div><div class="doc"><pre class="plaintext">Aborts the ongoing transaction.


@ producer
  Kafka producer.

=&gt; `producer`


Throws

  java.lang
 
    IllegalStateException
      When no 'transactional.id' has been configured.

  org.apache.kafka.common.errors

    ProducerFencedException
      When another producer with the same transaction id is already active.

    UnsupportedVersionException
      When the broker does not support transactions.

    AuthorizationException
      When the 'transactional.id' is not authorized.

    KafkaException
      Any other unrecoverable error.</pre></div></div><div class="public anchor" id="var-trx-begin"><h3>trx-begin</h3><div class="usage"><code>(trx-begin producer)</code></div><div class="doc"><pre class="plaintext">Must be called exactly once at the start of each new transaction.

&lt;!&gt; `trx-init` must be called before any transaction.


@ producer
  Kafka producer.

=&gt; `producer`


Throws

  java.lang
 
    IllegalStateException
      When no 'transactional.id' has been configured.

  org.apache.kafka.common.errors

    ProducerFencedException
      When another producer with the same transaction id is already active.

    UnsupportedVersionException
      When the broker does not support transactions.

    AuthorizationException
      When 'transactional.id' is not authorized.

    KafkaException
      Any other unrecoverable error.</pre></div></div><div class="public anchor" id="var-trx-commit"><h3>trx-commit</h3><div class="usage"><code>(trx-commit producer)</code></div><div class="doc"><pre class="plaintext">Commits the ongoing transaction.

A transaction succeeds only if every step succeeds.

If any record commit hit an irrecoverable error, this function will rethrow that exception and the transaction
will not be committed. 


@ producer
  Kafka producer.

=&gt; `producer`


Throws

  java.lang
 
    IllegalStateException
      When no 'transactional.id' has been configured.

  org.apache.kafka.common.errors

    ProducerFencedException
      When another producer with the same transaction id is already active.

    UnsupportedVersionException
      When the broker does not support transactions.

    AuthorizationException
      When the 'transactional.id' is not authorized.

    KafkaException
      Any other unrecoverable error.</pre></div></div><div class="public anchor" id="var-trx-init"><h3>trx-init</h3><div class="usage"><code>(trx-init producer)</code></div><div class="doc"><pre class="plaintext">When 'transactional.id' is set, needs to be called exactly once before doing any transaction.

Based on this id, ensures any previous transaction committed by a previous instance is completed or any pending
transaction is aborted. Further more, it prepares the producer for future ones.


@ producer
  Kafka producer.

=&gt; `producer`


Throws

  java.lang
 
    IllegalStateException
      When no 'transactional.id' has been configured.

  org.apache.kafka.common.errors

    UnsupportedVersionException
      When broker does not support transactions.

    AuthorizationException
      When the 'transactional.id' is not authorized.

    KafkaException
      Any other unrecoverable error.</pre></div></div><div class="public anchor" id="var-trx-offsets"><h3>trx-offsets</h3><div class="usage"><code>(trx-offsets producer group-id offsets)</code></div><div class="doc"><pre class="plaintext">Commits offsets for a consumer group id as part of the ongoing transaction.

Very useful for a consume-transform-produce use case.

The consumer polls records without committing its offsets ('enable.auto.commit' must be set to false). After some computation,
while in a transaction, the producer publishes results as well as the offsets (ie. for each topic partition, the offset of the
last processed record + 1). This garantees exacly once semantics.


@ producer
  Kafka producer.

=&gt; `producer`


Throws

  java.lang
 
    IllegalStateException
      When no 'transactional.id' has been configured.

  org.apache.kafka.common.errors

    ProducerFencedException
      When another producer with the same transaction id is already active.

    UnsupportedVersionException
      When the broker does not support transactions.

    AuthorizationException
      When the 'transactional.id' is not authorized.

    KafkaException
      Any other unrecoverable error.</pre></div></div></div></body></html>