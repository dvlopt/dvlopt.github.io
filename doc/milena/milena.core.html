<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>milena.core documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Milena</span> <span class="project-version">0.0.0-alpha3</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>milena</span></div></div></li><li class="depth-2 branch"><a href="milena.converters.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>converters</span></div></a></li><li class="depth-2 current"><a href="milena.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="milena.core.html#var-close"><div class="inner"><span>close</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-commit-async"><div class="inner"><span>commit-async</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-commit-sync"><div class="inner"><span>commit-sync</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-committed"><div class="inner"><span>committed</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-consumer"><div class="inner"><span>consumer</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-deserialize"><div class="inner"><span>deserialize</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-deserializers"><div class="inner"><span>deserializers</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-forward"><div class="inner"><span>forward</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-interrupt-consumer"><div class="inner"><span>interrupt-consumer</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-kderef"><div class="inner"><span>kderef</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-ksend"><div class="inner"><span>ksend</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-listen"><div class="inner"><span>listen</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-listening"><div class="inner"><span>listening</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-listening.3F"><div class="inner"><span>listening?</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-make-deserializer"><div class="inner"><span>make-deserializer</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-make-serializer"><div class="inner"><span>make-serializer</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-metrics"><div class="inner"><span>metrics</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-nodes-string"><div class="inner"><span>nodes-string</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-now"><div class="inner"><span>now</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-offsets-earliest"><div class="inner"><span>offsets-earliest</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-offsets-latest"><div class="inner"><span>offsets-latest</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-offsets-search"><div class="inner"><span>offsets-search</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-partition.3F"><div class="inner"><span>partition?</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-partitions"><div class="inner"><span>partitions</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-pause"><div class="inner"><span>pause</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-paused"><div class="inner"><span>paused</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-paused.3F"><div class="inner"><span>paused?</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-pflush"><div class="inner"><span>pflush</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-poll"><div class="inner"><span>poll</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-poll-reduce"><div class="inner"><span>poll-reduce</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-position"><div class="inner"><span>position</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-producer"><div class="inner"><span>producer</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-resume"><div class="inner"><span>resume</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-rewind"><div class="inner"><span>rewind</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-safe-consume"><div class="inner"><span>safe-consume</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-seek"><div class="inner"><span>seek</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-serialize"><div class="inner"><span>serialize</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-serializers"><div class="inner"><span>serializers</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-topic.3F"><div class="inner"><span>topic?</span></div></a></li><li class="depth-1"><a href="milena.core.html#var-topics"><div class="inner"><span>topics</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">milena.core</h1><div class="doc"><pre class="plaintext">Fns for handling everything that is useful in the kafka client library.
This work doesn't try to be too clever or opiniated. Rather, it allows
one to think in term of clojure data structures instead of java interop.
Better semantics + data-driven.

&lt;!&gt; Sometimes, fns try and catch certain exceptions when it is meaningful.
    This behavior is subject to changes for the time being.</pre></div><div class="public anchor" id="var-close"><h3>close</h3><div class="usage"><code>(close producer|consumer)</code><code>(close producer|consumer timeout-ms)</code></div><div class="doc"><pre class="plaintext">Close a producer or a consumer.

A producer will wait until all sends are done or the optional
timeout is elapsed.

A consumer will wait at most  until the optional timeout or
a default one of 30 seconds giving a chance for a cleanup such
as commiting offsets.</pre></div></div><div class="public anchor" id="var-commit-async"><h3>commit-async</h3><div class="usage"><code>(commit-async consumer)</code><code>(commit-async consumer callback)</code><code>(commit-async consumer offsets callback)</code></div><div class="doc"><pre class="plaintext">Non-blocking commit of offsets.

cf. milena.core/commit-sync
    milena.converters/f-&gt;OffsetCommitCallback</pre></div></div><div class="public anchor" id="var-commit-sync"><h3>commit-sync</h3><div class="usage"><code>(commit-sync consumer)</code><code>(commit-sync consumer offsets)</code></div><div class="doc"><pre class="plaintext">Blocking commit of offsets.

offsets : optional map of [topic partition] -&gt; offset

If 'offsets' is not provided, it will commit offsets
returned on the last call to milena.core/poll on this
consumer.</pre></div></div><div class="public anchor" id="var-committed"><h3>committed</h3><div class="usage"><code>(committed consumer ktopic kpart)</code><code>(committed consumer kpartitions)</code></div><div class="doc"><pre class="plaintext">Get the last committed offset for the given partition.

May block if the partition isn't assigned to this consumer or
if the consumer hasn't yet initialized its cache of committed
offsets.

ktopic : topic
kpart : partition number

Returns the last committed offset.

-----------

kpartitions : a list of [topic partition]

Returns a map of [topic partition] -&gt; last comitted offset</pre></div></div><div class="public anchor" id="var-consumer"><h3>consumer</h3><div class="usage"><code>(consumer &amp; [{:keys [nodes deserializer deserializer-key deserializer-value], :or {nodes [["localhost" 9092]], deserializer (deserializers :byte-array), deserializer-key deserializer, deserializer-value deserializer}} kopts])</code></div><div class="doc"><pre class="plaintext">Build a Kafka consumer.

config : read the signature
kopts : optional consumer options (cf. Kafka documentation)

&lt;!&gt; Consumers are NOT thread safe !
    1 consumer / thread or a queueing policy must be
    implemented.</pre></div></div><div class="public anchor" id="var-deserialize"><h3>deserialize</h3><div class="usage"><code>(deserialize deserializer ktopic data)</code></div><div class="doc"><pre class="plaintext">Deserialize data using a Kafka deserializer
</pre></div></div><div class="public anchor" id="var-deserializers"><h3>deserializers</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Basic deserializers provided by Kafka
</pre></div></div><div class="public anchor" id="var-forward"><h3>forward</h3><div class="usage"><code>(forward consumer kpartitions)</code><code>(forward consumer ktopic kpart)</code></div><div class="doc"><pre class="plaintext">Fast forward a consumer for the required partitions.

cf. milena.core/rewind</pre></div></div><div class="public anchor" id="var-interrupt-consumer"><h3>interrupt-consumer</h3><div class="usage"><code>(interrupt-consumer consumer)</code></div><div class="doc"><pre class="plaintext">From another thread, unblock the consumer. The blocking thread
will throw an org.apache.kafka.common.errors.WakeupException.

If the thread isn't blocking on a fn which can throw such an
exception, the next call to such a fn will raise it instead.

Must be used sparingly, not to compensate for a bad design.</pre></div></div><div class="public anchor" id="var-kderef"><h3>kderef</h3><div class="usage"><code>(kderef kfuture)</code><code>(kderef kfuture timeout-ms timeout-val)</code></div><div class="doc"><pre class="plaintext">Deref a future returned by milena.core/ksend by converting
the metadata about the sent record to a map.</pre></div></div><div class="public anchor" id="var-ksend"><h3>ksend</h3><div class="usage"><code>(ksend producer message &amp; [f-cb])</code></div><div class="doc"><pre class="plaintext">Send a message to Kafka via a producer.

message : a map (cf. milena.converters/hmap-&gt;ProducerRecord)
f-cb : an optional callback for when the send completes
       (cf. milena.converters/f-&gt;Callback)

Returns a future resolving to metadata about the record, the same map
given to 'f-cb' (cf. milena.converters/RecordMetadata-&gt;hmap</pre></div></div><div class="public anchor" id="var-listen"><h3>listen</h3><div class="usage"><code>(listen consumer source &amp; [f-rebalance])</code></div><div class="doc"><pre class="plaintext">Subscribe a consumer to topics or assign it to partition.

An assignement precisely refers to a [topic partition] whereas
a subscription only ask for a topic, the partition being assigned
dynamically.

source : a regular expression
       | a list of topics as strings to subscribe to
       | a list of [topic partition] to be assigned to
       | nil for explicitly stopping listening
f-rebalance : a fn being called when the consumer has been
              assigned or revoked (optional unless 'source' is a regex)
              (cf. milena.converters/f-&gt;ConsumerRebalanceListener)

&lt;!&gt; A consumer can only consume from one type of source, it will throws if
    you try to mix, for instance, subscriptions and assignments</pre></div></div><div class="public anchor" id="var-listening"><h3>listening</h3><div class="usage"><code>(listening consumer)</code></div><div class="doc"><pre class="plaintext">Get all the partitions the consumer is assigned to as well as the
subscriptions.

cf. milena.core/listen</pre></div></div><div class="public anchor" id="var-listening.3F"><h3>listening?</h3><div class="usage"><code>(listening? consumer source)</code></div><div class="doc"><pre class="plaintext">Is the consumer listening to the given topic / [topic partition] ?
</pre></div></div><div class="public anchor" id="var-make-deserializer"><h3>make-deserializer</h3><div class="usage"><code>(make-deserializer f)</code></div><div class="doc"><pre class="plaintext">Given a fn that takes a topic and data to deserialize,
make a Kafka deserializer for consumers</pre></div></div><div class="public anchor" id="var-make-serializer"><h3>make-serializer</h3><div class="usage"><code>(make-serializer f)</code></div><div class="doc"><pre class="plaintext">Given a fn that takes a topic and data to serialize,
make a Kafka serializer for producers</pre></div></div><div class="public anchor" id="var-metrics"><h3>metrics</h3><div class="usage"><code>(metrics producer|consumer)</code></div><div class="doc"><pre class="plaintext">Get the metrics of a producer or a consumer as a map
</pre></div></div><div class="public anchor" id="var-nodes-string"><h3>nodes-string</h3><div class="usage"><code>(nodes-string &amp; [nodes])</code></div><div class="doc"><pre class="plaintext">Produce a string of Kafka nodes for producers and consumers.

nodes : a list of [host port] representing Kafka nodes</pre></div></div><div class="public anchor" id="var-now"><h3>now</h3><div class="usage"><code>(now)</code></div><div class="doc"><pre class="plaintext">Get the unix time in milliseconds
</pre></div></div><div class="public anchor" id="var-offsets-earliest"><h3>offsets-earliest</h3><div class="usage"><code>(offsets-earliest consumer kpartitions)</code><code>(offsets-earliest consumer ktopic kpart)</code></div><div class="doc"><pre class="plaintext">Get the earliest offsets exiting for the required partitions

kpartitions : a list of [topic partition]

Returns a map of [topic partition] -&gt; offset

----------

ktopic : topic
kpart : partition

Returns the offset

&lt;!&gt; Will block forever if the topic doesn't exist and dynamic
    creation has been disabled server-side.</pre></div></div><div class="public anchor" id="var-offsets-latest"><h3>offsets-latest</h3><div class="usage"><code>(offsets-latest consumer kpartitions)</code><code>(offsets-latest consumer ktopic kpart)</code></div><div class="doc"><pre class="plaintext">Get the latest offsets existing for the required partitions

cf. milena.core/offsets-earliest</pre></div></div><div class="public anchor" id="var-offsets-search"><h3>offsets-search</h3><div class="usage"><code>(offsets-search consumer kpartitions+ts)</code><code>(offsets-search consumer ktopic kpart ts)</code></div><div class="doc"><pre class="plaintext">Search for offsets by timestamp

kpartitions+ts : a map of [topic partition] -&gt; timestamp in unix time

Returns a map of [topic partition] -&gt; offset where offset is refering
to the first message published at or after the corresponding timestamp.

----------

ktopic : topic
kpart : partition number
ts : timestamp in unix time

Returns the offset

&lt;!&gt; Will block forever if the topic doesn't exist and dynamic creation
    has been disabled server-side.</pre></div></div><div class="public anchor" id="var-partition.3F"><h3>partition?</h3><div class="usage"><code>(partition? consumer|producer ktopic kpart)</code><code>(partition? consumer|producer [ktopic kpart])</code></div><div class="doc"><pre class="plaintext">Using a producer or a consumer, returns if the given
[topic partition] exists.

cf. milena.core/partitions</pre></div></div><div class="public anchor" id="var-partitions"><h3>partitions</h3><div class="usage"><code>(partitions producer|consumer ktopic)</code></div><div class="doc"><pre class="plaintext">Using a producer or a consumer, get a list of partitions
for a given topic.

&lt;!&gt; Producer will block for ever is the topic doesn't exist
    and dynamic creation has been disabled server-side.</pre></div></div><div class="public anchor" id="var-pause"><h3>pause</h3><div class="usage"><code>(pause consumer kpartitions)</code><code>(pause consumer ktopic kpart)</code></div><div class="doc"><pre class="plaintext">Temporarely pause consumption for a partition or a list of [topic partition]
</pre></div></div><div class="public anchor" id="var-paused"><h3>paused</h3><div class="usage"><code>(paused consumer)</code></div><div class="doc"><pre class="plaintext">Get a list of [topic partition] currently being paused.

cf. milena.core/pause</pre></div></div><div class="public anchor" id="var-paused.3F"><h3>paused?</h3><div class="usage"><code>(paused? consumer kpartition)</code><code>(paused? consumer ktopic kpart)</code></div><div class="doc"><pre class="plaintext">Is a [topic partition] currenly paused ?

cf. milena.core/pause</pre></div></div><div class="public anchor" id="var-pflush"><h3>pflush</h3><div class="usage"><code>(pflush producer)</code></div><div class="doc"><pre class="plaintext">Flush a producer. Will block until all messages are effectively sent.

Returns true or false whether the flush succeeded or not.</pre></div></div><div class="public anchor" id="var-poll"><h3>poll</h3><div class="usage"><code>(poll consumer timeout)</code></div><div class="doc"><pre class="plaintext">Poll messages or wait up to 'timeout' if there aren't any.

A timeout of 0 returns what is available in the consumer buffer
without blocking.</pre></div></div><div class="public anchor" id="var-poll-reduce"><h3>poll-reduce</h3><div class="usage"><code>(poll-reduce consumer timeout f acc)</code><code>(poll-reduce consumer timeout f acc f-continue?)</code></div><div class="doc"><pre class="plaintext">Poll and reduce messages.

f : a classic 2-args reducing fn 
seed : the initial value for the reducing fn
f-continue? : an optional fn accepting all last messages
              and returning true or false whether polling
              should continue or not.

cf. milena.core/poll</pre></div></div><div class="public anchor" id="var-position"><h3>position</h3><div class="usage"><code>(position consumer ktopic kpart)</code><code>(position consumer kpartitions)</code></div><div class="doc"><pre class="plaintext">Returns the current position of the consumer, or nil
if something is wrong/unavailable.

ktopic : topic
kpart : partition number

Returns the current position

----------

kpartitions : a list of [topic partition]

Returns a map of [topic partition] -&gt; current position</pre></div></div><div class="public anchor" id="var-producer"><h3>producer</h3><div class="usage"><code>(producer &amp; [{:as config, :keys [nodes serializer serializer-key serializer-value], :or {nodes [["localhost" 9092]], serializer (serializers :byte-array), serializer-key serializer, serializer-value serializer}} kopts])</code></div><div class="doc"><pre class="plaintext">Build a Kafka producer.

config : read the signature
         (cf. milena.core/nodes-string)
kopts : optional producer options (cf. Kafka documentation)

Producer are thread-safe and it is more efficient to share
one amongst multiple threads.</pre></div></div><div class="public anchor" id="var-resume"><h3>resume</h3><div class="usage"><code>(resume consumer kpartitions)</code><code>(resume consumer ktopic kpart)</code></div><div class="doc"><pre class="plaintext">Resume a partition or a list of [topic partition].

cf. milena.core/pause</pre></div></div><div class="public anchor" id="var-rewind"><h3>rewind</h3><div class="usage"><code>(rewind consumer kpartitions)</code><code>(rewind consumer ktopic kpart)</code></div><div class="doc"><pre class="plaintext">Rewind a consumer for the required partitions.

kpartitions : a list of [topic partition]

----------

ktopic : topic
kpart : partition</pre></div></div><div class="public anchor" id="var-safe-consume"><h3>safe-consume</h3><h4 class="type">macro</h4><div class="usage"><code>(safe-consume consumer timeout &amp; body)</code></div><div class="doc"><pre class="plaintext">If the body doesn't compute before the required timeout,
milena.core/interrupt-consumer will be called on the consumer.</pre></div></div><div class="public anchor" id="var-seek"><h3>seek</h3><div class="usage"><code>(seek consumer ktopic kpart position)</code><code>(seek consumer kpartitions position)</code></div><div class="doc"><pre class="plaintext">Seek a partition or a list of [topic partition] to a new position.

ktopic : topic
kpart : partition number
position : new position

-----------

kpartitions : a list of [topic partition]
position : new position</pre></div></div><div class="public anchor" id="var-serialize"><h3>serialize</h3><div class="usage"><code>(serialize serializer ktopic data)</code></div><div class="doc"><pre class="plaintext">Serialize data using a Kafka serializer
</pre></div></div><div class="public anchor" id="var-serializers"><h3>serializers</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Basic serializers provided by Kafka
</pre></div></div><div class="public anchor" id="var-topic.3F"><h3>topic?</h3><div class="usage"><code>(topic? consumer|producer ktopic)</code></div><div class="doc"><pre class="plaintext">Using a producer or a consumer, returns if the given topic
exists.

cf. milena.core/partitions</pre></div></div><div class="public anchor" id="var-topics"><h3>topics</h3><div class="usage"><code>(topics consumer)</code></div><div class="doc"><pre class="plaintext">Get metadata about partitions for all topics the consumer
is authorized to consume.

cf. milena.converters/PartitionInfo-&gt;hmap</pre></div></div></div></body></html>