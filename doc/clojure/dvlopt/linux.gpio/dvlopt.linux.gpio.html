<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>dvlopt.linux.gpio documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Linux.gpio</span> <span class="project-version">1.0.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="dvlopt.linux.gpio.html"><div class="inner"><span>dvlopt.linux.gpio</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="dvlopt.linux.gpio.html#var-close"><div class="inner"><span>close</span></div></a></li><li class="depth-1"><a href="dvlopt.linux.gpio.html#var-defaults"><div class="inner"><span>defaults</span></div></a></li><li class="depth-1"><a href="dvlopt.linux.gpio.html#var-describe-chip"><div class="inner"><span>describe-chip</span></div></a></li><li class="depth-1"><a href="dvlopt.linux.gpio.html#var-describe-line"><div class="inner"><span>describe-line</span></div></a></li><li class="depth-1"><a href="dvlopt.linux.gpio.html#var-device"><div class="inner"><span>device</span></div></a></li><li class="depth-1"><a href="dvlopt.linux.gpio.html#var-handle"><div class="inner"><span>handle</span></div></a></li><li class="depth-1"><a href="dvlopt.linux.gpio.html#var-IBuffer"><div class="inner"><span>IBuffer</span></div></a></li><li class="depth-2 branch"><a href="dvlopt.linux.gpio.html#var-clear-lines"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clear-lines</span></div></a></li><li class="depth-2 branch"><a href="dvlopt.linux.gpio.html#var-get-line"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>get-line</span></div></a></li><li class="depth-2 branch"><a href="dvlopt.linux.gpio.html#var-get-lines"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>get-lines</span></div></a></li><li class="depth-2 branch"><a href="dvlopt.linux.gpio.html#var-set-line"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>set-line</span></div></a></li><li class="depth-2 branch"><a href="dvlopt.linux.gpio.html#var-set-lines"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>set-lines</span></div></a></li><li class="depth-2 branch"><a href="dvlopt.linux.gpio.html#var-toggle-line"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>toggle-line</span></div></a></li><li class="depth-2"><a href="dvlopt.linux.gpio.html#var-toggle-lines"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>toggle-lines</span></div></a></li><li class="depth-1"><a href="dvlopt.linux.gpio.html#var-IBuffereable"><div class="inner"><span>IBuffereable</span></div></a></li><li class="depth-2"><a href="dvlopt.linux.gpio.html#var-buffer"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>buffer</span></div></a></li><li class="depth-1"><a href="dvlopt.linux.gpio.html#var-IHandle"><div class="inner"><span>IHandle</span></div></a></li><li class="depth-2 branch"><a href="dvlopt.linux.gpio.html#var-read"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>read</span></div></a></li><li class="depth-2"><a href="dvlopt.linux.gpio.html#var-write"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>write</span></div></a></li><li class="depth-1"><a href="dvlopt.linux.gpio.html#var-IWatcher"><div class="inner"><span>IWatcher</span></div></a></li><li class="depth-2 branch"><a href="dvlopt.linux.gpio.html#var-event"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>event</span></div></a></li><li class="depth-2"><a href="dvlopt.linux.gpio.html#var-poll"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>poll</span></div></a></li><li class="depth-1"><a href="dvlopt.linux.gpio.html#var-watcher"><div class="inner"><span>watcher</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">dvlopt.linux.gpio</h1><div class="doc"><pre class="plaintext">This namespace provides utilities for handling a GPIO device. Compatible with Linux 4.8 and higher.

Access to a GPIO device can be obtained by using the `device` function. Three things can then be accomplished :

    - Request some information about the GPIO device or a specific GPIO line.
    - Request a handle for driving one or several lines at once.
    - Request a watcher for efficiently monitoring one or several lines.

A handle controls all the lines it is responsible for at once. Whether those lines are actually driven exactly at
the same time, atomically, depends on the underlying driver and is opaque to this library. Once a handle is created
with the `handle` function on the appropriate GPIO device, one or several dedicated buffers can be created with the
`buffer` function. The purpose of a buffer is to represent and/or manipulate the state of the lines controlled by a
handle (up to 64). The state of a line can either be HIGH (true) or LOW (false).

A watcher is used essentially for interrupts. Requested events, such as a line transitioning from LOW to HIGH, are
queued by the kernel until read. However, Linux not being a real-time OS, such "interrupts" are imperfect and should
not be used for critical tasks where a simple microcontroller will be of a better fit.

Lines are abstracted by associating a line number with a tag (ie. any value meant to be more representative of what the
line does, often a keyword).

As usual, all IO functions might throw if anything goes wrong and do not forget to use `close` or the "with-open idiom"
on all acquired IO resources. Closing a GPIO device do not close related handles and watchers.


Here is a description of the keywords typically used throughout this library :

 ::active-low?
   Lines are typically active-high, meaning they become active when HIGH (true) and inactive when LOW (false). Active-low
   lines reverse this logical flow. They become active when LOW and inactive when HIGH.

 ::consumer
   An arbitrary string can be supplied when creating a handle. If a line is in use and associated with a consumer, it will
   show up when querying its state using `describe-line`. It allows for tracking who is using what.

 ::direction
   A line can either be used as :input or :output, never both at the same time. All lines associated
   with a handle must be of the same direction.

 ::label
   The operating system might associate a GPIO device and individual lines with string labels.

 ::line-number
   A single GPIO device can represent at most 64 lines. Hence, a line number is between 0 and 63 inclusive.

 ::name
   The operating system might associate a GPIO device and individual lines with string names.

 ::open-drain?
   Lines can act as open drains (ie. can only be driven to LOW).

 ::open-source?
   Lines can be open sources (ie. can only be driven to HIGH).

 ::state
   The state of a line can either be logical HIGH (true) or logical LOW (false).

 ::tag
   Instead of using raw line numbers which don't really mean anything, they can be associated with any value such
   as a string or a keyword. Besides being more descriptive, the program remains valid when the user dedices to use
   different lines while creating a handle (as long as tags remain the same).</pre></div><div class="public anchor" id="var-close"><h3>close</h3><div class="usage"><code>(close resource)</code></div><div class="doc"><pre class="plaintext">Closes a GPIO resource such as a device or a handle.

It may be easier to use the standard `with-open` macro.</pre></div></div><div class="public anchor" id="var-defaults"><h3>defaults</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Default values for argument options.
</pre></div></div><div class="public anchor" id="var-describe-chip"><h3>describe-chip</h3><div class="usage"><code>(describe-chip device)</code></div><div class="doc"><pre class="plaintext">Requests a description of the given GPIO device.

Returns a map containing :

  ::label (optional)
    Cf. Namespace description

  ::n-lines
    Number of available lines for that chip.

  ::name (optional)
    Cf. Namespace description.</pre></div></div><div class="public anchor" id="var-describe-line"><h3>describe-line</h3><div class="usage"><code>(describe-line device line-number)</code></div><div class="doc"><pre class="plaintext">Requests a description of the given line.

Returns a map which may contain :

  ::active-low?
  ::consumer (optional)
  ::direction
    Cf. Namespace description

  ::line-number
    Number of the line.

  ::name (optional)
  ::open-drain?
  ::open-source?
    Cf. Namespace description

  ::used?
    Is this line currently in use ?</pre></div></div><div class="public anchor" id="var-device"><h3>device</h3><div class="usage"><code>(device device-path)</code></div><div class="doc"><pre class="plaintext">Opens a GPIO device either by specifying a full path or by giving the number of the device.

Those devices are located at '/dev/gpiochip$X' where $X is a number.

Read permission must be granted, which is enough even for writing to outputs.

Attention, closing a GPIO device does not close related handles and watchers.</pre></div></div><div class="public anchor" id="var-handle"><h3>handle</h3><div class="usage"><code>(handle device lines-number-&gt;line-options)</code><code>(handle device line-number-&gt;line-options handle-options)</code></div><div class="doc"><pre class="plaintext">Given a GPIO device, requests a handle for one or several lines which can then be used to read and/or write
the state of lines.

Implements `IHandle`.


`line-number-&gt;line-options` is a map where keys are line numbers and values are maps which may contain :

  ::state
  ::tag
    Cf. Namespace description


`handle-options` is an optional map which may contain :

  ::active-low?
  ::consumer
  ::direction
  ::open-drain?
  ::open-source?
    Cf. Namespace description


Ex. (handle some-device
            {17 {::tag :red-led}
             27 {::tag   :green-led
                 ::state true}}
            {::direction :output})</pre></div></div><div class="public anchor" id="var-IBuffer"><h3>IBuffer</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Reading or writing the state of lines in a buffer before or after doing some IO.

Ex. (write some-handle
           (-&gt; some-buffer
               (clear-lines)
               (set-lines {:green-led true
                           :red-led   false})))</pre></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-clear-lines"><h3>clear-lines</h3><div class="usage"><code>(clear-lines buffer)</code></div><div class="doc"><pre class="plaintext">Sets all lines of the given buffer to LOW (false).
</pre></div></div><div class="public anchor" id="var-get-line"><h3>get-line</h3><div class="usage"><code>(get-line buffer tag)</code></div><div class="doc"><pre class="plaintext">Retrieves the state of a single line from the given buffer.
</pre></div></div><div class="public anchor" id="var-get-lines"><h3>get-lines</h3><div class="usage"><code>(get-lines buffer)</code><code>(get-lines buffer tags)</code></div><div class="doc"><pre class="plaintext">Retrieves the state of several lines (or all of them if nothing is specified) from the given buffer.

Returns a map of tag -&gt; state.</pre></div></div><div class="public anchor" id="var-set-line"><h3>set-line</h3><div class="usage"><code>(set-line buffer tag state)</code></div><div class="doc"><pre class="plaintext">Sets the state of a single line in the given buffer.
</pre></div></div><div class="public anchor" id="var-set-lines"><h3>set-lines</h3><div class="usage"><code>(set-lines buffer tag-&gt;state)</code></div><div class="doc"><pre class="plaintext">Sets the state of several lines in the given buffer.
</pre></div></div><div class="public anchor" id="var-toggle-line"><h3>toggle-line</h3><div class="usage"><code>(toggle-line buffer tag)</code></div><div class="doc"><pre class="plaintext">Toggles the state of a single line in the given buffer.
</pre></div></div><div class="public anchor" id="var-toggle-lines"><h3>toggle-lines</h3><div class="usage"><code>(toggle-lines buffer)</code><code>(toggle-lines buffer tags)</code></div><div class="doc"><pre class="plaintext">Toggles the state of several lines in the given buffer.
</pre></div></div></div></div></div><div class="public anchor" id="var-IBuffereable"><h3>IBuffereable</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><pre class="plaintext">For objects that can work with a GPIO buffer.
</pre></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-buffer"><h3>buffer</h3><div class="usage"><code>(buffer this)</code></div><div class="doc"><pre class="plaintext">Produces a GPIO buffer representing the state of up to 64 lines.

It implements `IBuffer` and works with tags associated with `this`.

It does not do any IO on its own as it is meant to be used in conjunction with a
handle or a watcher.</pre></div></div></div></div></div><div class="public anchor" id="var-IHandle"><h3>IHandle</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><pre class="plaintext">IO using a GPIO handle and a associated buffer.

Reading or writing the state of lines happens virtually at once for all of them. Whether it happens exactly
at the same time depends on the underlying driver and this fact is opaque. In any case, driving several
lines using a single handle is more efficient than using a handle for each line.</pre></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-read"><h3>read</h3><div class="usage"><code>(read handle buffer)</code></div><div class="doc"><pre class="plaintext">Using a handle, reads the current state of lines into the given buffer.
</pre></div></div><div class="public anchor" id="var-write"><h3>write</h3><div class="usage"><code>(write handle buffer)</code></div><div class="doc"><pre class="plaintext">Using a handle, writes the current state of lines using the given buffer.
</pre></div></div></div></div></div><div class="public anchor" id="var-IWatcher"><h3>IWatcher</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><pre class="plaintext">IO using a watcher.
</pre></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-event"><h3>event</h3><div class="usage"><code>(event watcher)</code><code>(event watcher timeout-ms)</code></div><div class="doc"><pre class="plaintext">Using a watcher, efficiently blocks until the state of one of the monitored inputs switches to a relevant
one or the timeout elapses.

A timeout of -1 will block forever until something happens.</pre></div></div><div class="public anchor" id="var-poll"><h3>poll</h3><div class="usage"><code>(poll watcher buffer tag)</code></div><div class="doc"><pre class="plaintext">Using a watcher, reads the current state of a line.
</pre></div></div></div></div></div><div class="public anchor" id="var-watcher"><h3>watcher</h3><div class="usage"><code>(watcher device line-number-&gt;watch-options)</code></div><div class="doc"><pre class="plaintext">Given a GPIO device, produces a watcher which can then be used to efficiently monitor inputs for changes or poll
their current values.

Implements `IWatcher`.


`line-number-&gt;watch-options` is a map where keys are line numbers and values are maps which may contain :

  ::active-low?
  ::consumer
  ::direction
  ::open-drain?
  ::open-source?
  ::state
  ::tag
    Cf. Namespace description


Ex. (watcher some-device
             {18 {::tag       :left-button
                  ::direction :input}
              23 {::tag       :right-button
                  ::direction :output}})</pre></div></div></div></body></html>