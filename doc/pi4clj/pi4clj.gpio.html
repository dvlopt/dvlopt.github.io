<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>pi4clj.gpio documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Pi4clj</span> <span class="project-version">0.0.0-alpha2</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pi4clj</span></div></div></li><li class="depth-2 current"><a href="pi4clj.gpio.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>gpio</span></div></a></li><li class="depth-3"><a href="pi4clj.gpio.emulate.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>emulate</span></div></a></li><li class="depth-2"><a href="pi4clj.i2c.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>i2c</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="pi4clj.gpio.html#var-board-revision"><div class="inner"><span>board-revision</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-config-pwm"><div class="inner"><span>config-pwm</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-digital-in"><div class="inner"><span>digital-in</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-digital-out"><div class="inner"><span>digital-out</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-enforce-scheme"><div class="inner"><span>enforce-scheme</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-gpio-clock"><div class="inner"><span>gpio-clock</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-listen"><div class="inner"><span>listen</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-listeners"><div class="inner"><span>listeners</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-monitor"><div class="inner"><span>monitor</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-monitored"><div class="inner"><span>monitored</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-pull-resistance"><div class="inner"><span>pull-resistance</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-pwm-out"><div class="inner"><span>pwm-out</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-rd-analog"><div class="inner"><span>rd-analog</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-rd-digital"><div class="inner"><span>rd-digital</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-scheme"><div class="inner"><span>scheme</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-shutdown-monitoring"><div class="inner"><span>shutdown-monitoring</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-tg-digital"><div class="inner"><span>tg-digital</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-wr-analog"><div class="inner"><span>wr-analog</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-wr-digital"><div class="inner"><span>wr-digital</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-wr-gpio-clock"><div class="inner"><span>wr-gpio-clock</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-wr-pwm"><div class="inner"><span>wr-pwm</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">pi4clj.gpio</h1><div class="doc"><pre class="plaintext">Everything related to hardware GPIO. 

Prior to any IO operation, a pin numbering scheme must be chosen
(cf. scheme).

Inputs and outputs have to be declared via functions :

   - digital-in
   - digital-out
   - pwm-out
   - gpio-clock

rd-xxxx functions are for reading from an input.
wr-xxxx functions are for writing to an output.

A pin can be monitored for any change in value (cf. monitor).
The user can register listeners reacting to those changes (cf. listen).</pre></div><div class="public anchor" id="var-board-revision"><h3>board-revision</h3><div class="usage"><code>(board-revision)</code></div><div class="doc"><pre class="plaintext">Get the board revision number
</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L31">view source</a></div></div><div class="public anchor" id="var-config-pwm"><h3>config-pwm</h3><div class="usage"><code>(config-pwm &amp; [{:as config, :keys [mode clock-divisor range]}])</code></div><div class="doc"><pre class="plaintext">Hardware pwm outputs can be modified by 3 options :

    - :mode
    - :clock-divisor
    - :range

These options modify the behavior of all the hardware
pwm outputs.

Two pwm modes are available, modifying how the duty cycle
is modeled (25% in this example) :

    :mark-space
    __      __
      ______  ______

    :balanced (default)
    _   _   _   _
     ___ ___ ___ ___

The pwm clock increments a counter at each pulse. When
this counter hits a value specified by the range, it
resets to 0 and it is equivalent to a period. The range
is therefore the number of pulses per period (default to
1024).

On the Raspberry Pi, the base pwm clock is 19.2MHz

    duty cycle = range / value

In :balanced mode, the frequency varies with the duty cycle.

In :mark-space mode, a higher range results in a better
resolution but a lower frequency as such :

    frequency = 19.2MHz / clock-divisor / range

&lt;!&gt; Does not work in :sys numbering scheme.</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L443">view source</a></div></div><div class="public anchor" id="var-digital-in"><h3>digital-in</h3><div class="usage"><code>(digital-in pin &amp; [{:keys [pull monitor?]}])</code></div><div class="doc"><pre class="plaintext">Declare the given pin as a digital input.

Can set pull resistance via :pull
        monitoring      via :monitor?

Cf. pi4clj.gpio/pull-resistance
    pi4clj.gpio/monitor


;; pin 2, monitored and pulled-down

(pi4clj.gpio/digital-in 2
                        {:pull       :down
                         :monitored? true})</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L406">view source</a></div></div><div class="public anchor" id="var-digital-out"><h3>digital-out</h3><div class="usage"><code>(digital-out pin &amp; [state])</code></div><div class="doc"><pre class="plaintext">Declare the given pin as a digital output.

Optionally accepts true or false as a start value.

Cf. pi4clj.gpio/wr-digital


;; pin 0 set to high

(pi4clj.gpio/digital-out 0
                         true)</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L360">view source</a></div></div><div class="public anchor" id="var-enforce-scheme"><h3>enforce-scheme</h3><h4 class="type">macro</h4><div class="usage"><code>(enforce-scheme &amp; forms)</code></div><div class="doc"><pre class="plaintext">Execute the given forms after ensuring that a numbering scheme
has been chosen, defaulting to :wiring-pi if none has been
explicitly selected.

Cf. scheme</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L181">view source</a></div></div><div class="public anchor" id="var-gpio-clock"><h3>gpio-clock</h3><div class="usage"><code>(gpio-clock pin &amp; [frequency])</code></div><div class="doc"><pre class="plaintext">Declare the given pin as gpio clock.

Optionally accepts a frequency start value in Hertz.

Cf. pi4clj.gpio/wr-gpio-clock</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L556">view source</a></div></div><div class="public anchor" id="var-listen"><h3>listen</h3><div class="usage"><code>(listen kw f)</code></div><div class="doc"><pre class="plaintext">A listener is a function accepting a pin number and its value as
arguments. It is associated with a kewyord and is called everytime
the value of a monitored pin changes.

In this fashion, it is easy to register multiple listeners for a single
pin or listeners reacting to several ones.

In order to remove one, explicitly provide nil instead of a function.

Cf. monitor


;; do something when the relevant button is high
(pi4clj.gpio/listen :button
                    (fn [pin value]
                      (when (and (= pin 2)
                                 value)
                        (do-something))))</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L81">view source</a></div></div><div class="public anchor" id="var-listeners"><h3>listeners</h3><div class="usage"><code>(listeners)</code></div><div class="doc"><pre class="plaintext">Get a set of all the registered listeners.

Cf. listen</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L67">view source</a></div></div><div class="public anchor" id="var-monitor"><h3>monitor</h3><div class="usage"><code>(monitor pin on?)</code></div><div class="doc"><pre class="plaintext">Start or stop monitoring  the given pin.

Monitoring means that if the value of the pin changes, all users registered
listeners will be called.

Returns a boolean indicating whether the request succeeded or not.

&lt;!&gt; Consumes 1 thread/pin.

Cf. listen

;; start monitoring pin 2
(pi4clj.gpio/monitor 2 true)</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L221">view source</a></div></div><div class="public anchor" id="var-monitored"><h3>monitored</h3><div class="usage"><code>(monitored)</code></div><div class="doc"><pre class="plaintext">Get a set containing all the monitored pins.

Cf. monitor</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L208">view source</a></div></div><div class="public anchor" id="var-pull-resistance"><h3>pull-resistance</h3><div class="usage"><code>(pull-resistance pin resistance)</code></div><div class="doc"><pre class="plaintext">Set pull resistance to :off
                       :down
                       :up   for the given digital input.

&lt;!&gt; Does not work in :sys numbering scheme.</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L387">view source</a></div></div><div class="public anchor" id="var-pwm-out"><h3>pwm-out</h3><div class="usage"><code>(pwm-out pin &amp; [value])</code></div><div class="doc"><pre class="plaintext">Declare the given pin as a pwm output.
An optional start value can be provided.

Cf. pi4clj.gpio/config-pwm
    pi4clj.gpio/wr-pwm</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L519">view source</a></div></div><div class="public anchor" id="var-rd-analog"><h3>rd-analog</h3><div class="usage"><code>(rd-analog pin)</code></div><div class="doc"><pre class="plaintext">Read an int from an analog input.

WiringPi supports this if an extension is provided.
Modified versions of wiringPi for other boards might
have direct support.</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L282">view source</a></div></div><div class="public anchor" id="var-rd-digital"><h3>rd-digital</h3><div class="usage"><code>(rd-digital pin)</code></div><div class="doc"><pre class="plaintext">Read true or false from a digital input, corresponding respectively to
high and low</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L317">view source</a></div></div><div class="public anchor" id="var-scheme"><h3>scheme</h3><div class="usage"><code>(scheme scheme)</code></div><div class="doc"><pre class="plaintext">Start GPIO activity by choosing a pin numbering scheme.

3 numbering schemes are available :

    :wiring-pi   ;; wiringPi abstracted pin numbering, consistent across
                    models and revisions (recommended)
    :broadom     ;; broadcom pin numbering, might and will change across
                    models and revisions
    :sys         ;; same as :broadcom but can be executed without sudo

&lt;!&gt; :wiring-pi and :broadcom must be run as root because IO functions are
    writing directly to /dev/mem.

    :sys doesn't need to but is slower, not every IO functions is available
    and pins have to be exported and prepared in advance. It is recommended
    only when the program cannot run as root and IO is not too complex.

Once a scheme is chosen, it cannot be changed. Calling this function again
won't do anything.

IO functions always enforce that a scheme is chosen. If there isn't any, this
function will be called with the :wiring-pi scheme. Nonetheless, it is good
practise to always explicitly call this function at the start of the program.</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L127">view source</a></div></div><div class="public anchor" id="var-shutdown-monitoring"><h3>shutdown-monitoring</h3><div class="usage"><code>(shutdown-monitoring)</code></div><div class="doc"><pre class="plaintext">Kill all threads related to pin monitoring.

Useful for a shutdown.

Cf. monitor</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L258">view source</a></div></div><div class="public anchor" id="var-tg-digital"><h3>tg-digital</h3><div class="usage"><code>(tg-digital pin)</code></div><div class="doc"><pre class="plaintext">Toggle a digital output and return the new state
</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L345">view source</a></div></div><div class="public anchor" id="var-wr-analog"><h3>wr-analog</h3><div class="usage"><code>(wr-analog pin value)</code></div><div class="doc"><pre class="plaintext">Write an int to an analog output.

WiringPi supports this if an extension is provided.
Modified versions of wiringPi for other boards might
have direct support.</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L298">view source</a></div></div><div class="public anchor" id="var-wr-digital"><h3>wr-digital</h3><div class="usage"><code>(wr-digital pin state)</code></div><div class="doc"><pre class="plaintext">Set a digital output to true or false, corresponding respectively to high and low
</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L330">view source</a></div></div><div class="public anchor" id="var-wr-gpio-clock"><h3>wr-gpio-clock</h3><div class="usage"><code>(wr-gpio-clock pin frequency)</code></div><div class="doc"><pre class="plaintext">Set the frequency of the given gpio clock pin
</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L543">view source</a></div></div><div class="public anchor" id="var-wr-pwm"><h3>wr-pwm</h3><div class="usage"><code>(wr-pwm pin value)</code></div><div class="doc"><pre class="plaintext">Write an int value to the PWM register for the given pin.
The Raspberry Pi has a default range of 1024.

Cf. pi4clj.gpio/config-pwm</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha2/src/pi4clj/gpio.clj#L503">view source</a></div></div></div></body></html>