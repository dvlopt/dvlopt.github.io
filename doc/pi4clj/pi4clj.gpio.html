<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><link href="css/default.css" rel="stylesheet" type="text/css" /><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>pi4clj.gpio documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Pi4clj</span> <span class="project-version">0.0.0-alpha1</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pi4clj</span></div></div></li><li class="depth-2 branch current"><a href="pi4clj.gpio.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>gpio</span></div></a></li><li class="depth-2"><a href="pi4clj.i2c.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>i2c</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="pi4clj.gpio.html#var--main-listener"><div class="inner"><span>-main-listener</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-.3C.21analog"><div class="inner"><span>&lt;!analog</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-.3C.21digital"><div class="inner"><span>&lt;!digital</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-.3E.21analog"><div class="inner"><span>&gt;!analog</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-.3E.21digital"><div class="inner"><span>&gt;!digital</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-.3E.21gpio-clock"><div class="inner"><span>&gt;!gpio-clock</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-.3E.21hard-pwm"><div class="inner"><span>&gt;!hard-pwm</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-.3E.21soft-pwm"><div class="inner"><span>&gt;!soft-pwm</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-.3E.21soft-tone"><div class="inner"><span>&gt;!soft-tone</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-add-listener.21"><div class="inner"><span>add-listener!</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-as-digital-in"><div class="inner"><span>as-digital-in</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-as-digital-out"><div class="inner"><span>as-digital-out</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-as-gpio-clock"><div class="inner"><span>as-gpio-clock</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-as-hard-pwm-out"><div class="inner"><span>as-hard-pwm-out</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-as-soft-pwm-out"><div class="inner"><span>as-soft-pwm-out</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-as-soft-tone-out"><div class="inner"><span>as-soft-tone-out</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-board-revision"><div class="inner"><span>board-revision</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-high.3F"><div class="inner"><span>high?</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-listeners"><div class="inner"><span>listeners</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-low.3F"><div class="inner"><span>low?</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-monitor-pin.21"><div class="inner"><span>monitor-pin!</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-monitored-pins"><div class="inner"><span>monitored-pins</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-remove-all-listeners.21"><div class="inner"><span>remove-all-listeners!</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-remove-listener.21"><div class="inner"><span>remove-listener!</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-set-hard-pwm-config"><div class="inner"><span>set-hard-pwm-config</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-set-pull-resistance"><div class="inner"><span>set-pull-resistance</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-setup-mode"><div class="inner"><span>setup-mode</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-shutdown-monitoring.21"><div class="inner"><span>shutdown-monitoring!</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-start.21"><div class="inner"><span>start!</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-stop-soft-pwm"><div class="inner"><span>stop-soft-pwm</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-stop-soft-tone"><div class="inner"><span>stop-soft-tone</span></div></a></li><li class="depth-1"><a href="pi4clj.gpio.html#var-toggle"><div class="inner"><span>toggle</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">pi4clj.gpio</h1><div class="doc"><pre class="plaintext">Everything related to GPIO.

Before usage, 'start!' must be called to initialize the board.

Before using a pin, it must be set to a mode with any of the
'as-...' functions.

Supported pin modes :

   - digital-in
   - digital-out
   - hard-pwm-out
   - soft-pwm-out
   - soft-tone-out
   - gpio-clock

'&lt;!...' functions are for reads
'&gt;!...' functions are for writes

Digital inputs can be monitored using 'monitor-pin!'.

The user can register listeners using 'add-listener!' that
will be invoked everytime the value of any of the monitored pin
changes.</pre></div><div class="public anchor" id="var--main-listener"><h3>-main-listener</h3><div class="usage"></div><div class="doc"><pre class="plaintext">
</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L287">view source</a></div></div><div class="public anchor" id="var-.3C.21analog"><h3>&lt;!analog</h3><div class="usage"><code>(&lt;!analog pin)</code></div><div class="doc"><pre class="plaintext">Read an int from an analog input.

WiringPi supports this if an extension is provided.
Modified versions of wiringPi for other boards might
have direct support.</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L364">view source</a></div></div><div class="public anchor" id="var-.3C.21digital"><h3>&lt;!digital</h3><div class="usage"><code>(&lt;!digital pin)</code></div><div class="doc"><pre class="plaintext">Read :high or :low from a digital input
</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L396">view source</a></div></div><div class="public anchor" id="var-.3E.21analog"><h3>&gt;!analog</h3><div class="usage"><code>(&gt;!analog pin value)</code></div><div class="doc"><pre class="plaintext">Write an int to an analog output.

WiringPi supports this if an extension is provided.
Modified versions of wiringPi for other boards might
have direct support.</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L380">view source</a></div></div><div class="public anchor" id="var-.3E.21digital"><h3>&gt;!digital</h3><div class="usage"><code>(&gt;!digital pin state)</code></div><div class="doc"><pre class="plaintext">Set a digital output to :high or :low
</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L410">view source</a></div></div><div class="public anchor" id="var-.3E.21gpio-clock"><h3>&gt;!gpio-clock</h3><div class="usage"><code>(&gt;!gpio-clock pin frequency)</code></div><div class="doc"><pre class="plaintext">Sets the frequency of the given gpio clock pin
</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L442">view source</a></div></div><div class="public anchor" id="var-.3E.21hard-pwm"><h3>&gt;!hard-pwm</h3><div class="usage"><code>(&gt;!hard-pwm pin value)</code></div><div class="doc"><pre class="plaintext">Write an int value to the PWM register for the given pin.
The Raspberry Pi has a default range of 1024.

Cf. pi4clj.gpio/set-hard-pwm-config</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L455">view source</a></div></div><div class="public anchor" id="var-.3E.21soft-pwm"><h3>&gt;!soft-pwm</h3><div class="usage"><code>(&gt;!soft-pwm pin value)</code></div><div class="doc"><pre class="plaintext">Write an int to a software pwm output.
Within the limits of the declared range.

Cf. pi4clj.gpio/as-soft-pwm-out</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L471">view source</a></div></div><div class="public anchor" id="var-.3E.21soft-tone"><h3>&gt;!soft-tone</h3><div class="usage"><code>(&gt;!soft-tone pin frequency)</code></div><div class="doc"><pre class="plaintext">Change the frequence of the given software tone pin.

Maximum is 5000.</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L487">view source</a></div></div><div class="public anchor" id="var-add-listener.21"><h3>add-listener!</h3><div class="usage"><code>(add-listener! kw f)</code></div><div class="doc"><pre class="plaintext">Register a fn to be executed everytime the value of any
of the monitored pin changes. It is given the pin number
and the pin state as arguments.

It is registered with a keyword which can later be
used to remove the listener.

Returns the keyword.

Cf. pi4clj.gpio/monitor-pin!


;; prints the pin number and its current state
;; when any monitored pin changes value

(pi4clj.gpio/add-listener! :printer
                           println)</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L198">view source</a></div></div><div class="public anchor" id="var-as-digital-in"><h3>as-digital-in</h3><div class="usage"><code>(as-digital-in pin &amp; {:keys [pull monitor?]})</code></div><div class="doc"><pre class="plaintext">Declare the given pin as a digital input.

Can set pull resistance via :pull
        monitoring      via :monitor?

Cf. pi4clj.gpio/set-pull-resistance
    pi4clj.gpio/monitor-pin!


;; pin 2, monitored and pulled-down

(pi4clj.gpio/as-digital-in 2
                           :pull       :down
                           :monitored? true)</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L530">view source</a></div></div><div class="public anchor" id="var-as-digital-out"><h3>as-digital-out</h3><div class="usage"><code>(as-digital-out pin &amp; [state])</code></div><div class="doc"><pre class="plaintext">Declare the given pin as a digital output.

Optionally accepts :high
                   :low  as a start state.

Cf. pi4clj.gpio/&gt;!digital


;; pin 0 as :high

(pi4clj.gpio/as-digital-out 0
                            :high)</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L502">view source</a></div></div><div class="public anchor" id="var-as-gpio-clock"><h3>as-gpio-clock</h3><div class="usage"><code>(as-gpio-clock pin &amp; [frequency])</code></div><div class="doc"><pre class="plaintext">Declare the given pin as gpio clock.

Optionally accepts a frequency start value.

Cf. pi4clj.gpio/&gt;!gpio-clock</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L564">view source</a></div></div><div class="public anchor" id="var-as-hard-pwm-out"><h3>as-hard-pwm-out</h3><div class="usage"><code>(as-hard-pwm-out pin &amp; [value])</code></div><div class="doc"><pre class="plaintext">Declare the given pin as a hardware pwm output.
An optional start value can be provided.

Cf. pi4clj.gpio/set-hard-pwm-config
    pi4clj.gpio/&gt;!hard-pwm</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L584">view source</a></div></div><div class="public anchor" id="var-as-soft-pwm-out"><h3>as-soft-pwm-out</h3><div class="usage"><code>(as-soft-pwm-out pin &amp; {pwm-range :range, pwm-value :value, :or {pwm-range 100, pwm-value 0}})</code></div><div class="doc"><pre class="plaintext">Declare the given pin as software pwm output.

Creates thread and emulates mark:space pwm.
The pulse width is fixed at 100µs for efficiency.

Unlike hardware pwm outputs, the range can be
different for each pin. The default and recommended
range is 100.

The frequency is a function of the pulse width and
the range :

    recommended range x pulse width = period

    100 x 100µs = 10 000µs  =&gt;  100Hz

Thus, for a higher frequency at the expense of resolution,
decrease range.

Cf. pi4clj.gpio/set-hard-pwm-config


;; pin 3 with a value of 50 and a default range of 100
(pi4clj.gpio/as-soft-pwm-out! 3 :value 50)</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L605">view source</a></div></div><div class="public anchor" id="var-as-soft-tone-out"><h3>as-soft-tone-out</h3><div class="usage"><code>(as-soft-tone-out pin &amp; [frequency])</code></div><div class="doc"><pre class="plaintext">Declare the given pin as a software tone output.

Create a thread and emulate a tone output.

For efficiency reasons, the pulse width is 100µs.
Hence the maximum frequence is :

    1 / 0.0002 = 5KHz</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L662">view source</a></div></div><div class="public anchor" id="var-board-revision"><h3>board-revision</h3><div class="usage"><code>(board-revision)</code></div><div class="doc"><pre class="plaintext">Get the board revision number
</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L40">view source</a></div></div><div class="public anchor" id="var-high.3F"><h3>high?</h3><div class="usage"><code>(high? x)</code></div><div class="doc"><pre class="plaintext">Is a digital state high ?
</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L263">view source</a></div></div><div class="public anchor" id="var-listeners"><h3>listeners</h3><div class="usage"><code>(listeners)</code></div><div class="doc"><pre class="plaintext">Get a collection of all the keywords for the registered
listeners.</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L185">view source</a></div></div><div class="public anchor" id="var-low.3F"><h3>low?</h3><div class="usage"><code>(low? x)</code></div><div class="doc"><pre class="plaintext">Is a digital state low ?
</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L275">view source</a></div></div><div class="public anchor" id="var-monitor-pin.21"><h3>monitor-pin!</h3><div class="usage"><code>(monitor-pin! pin on?)</code></div><div class="doc"><pre class="plaintext">Start or stop monitoring for the given pin.

Monitoring means that if the value of the pin changes,
all user registered listeners will be notified

Cf. pi4clj.gpio/add-listener!

Consumes 1 thread/pin.

Returns * true
        * false whether the request succeeded or not


;; start monitoring pin 2
(pi4clj.gpio/monitor-pin! 2 true)</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L115">view source</a></div></div><div class="public anchor" id="var-monitored-pins"><h3>monitored-pins</h3><div class="usage"><code>(monitored-pins)</code></div><div class="doc"><pre class="plaintext">Get the set containing all the monitored pins.

Cf. pi4clj.gpio/monitor-pin!</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L102">view source</a></div></div><div class="public anchor" id="var-remove-all-listeners.21"><h3>remove-all-listeners!</h3><div class="usage"><code>(remove-all-listeners!)</code></div><div class="doc"><pre class="plaintext">Remove all listeners.

&lt;!&gt; does not turn off monitoring, merely delete listeners
    (cf. pi4clj/shutdown-monitoring!)</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L248">view source</a></div></div><div class="public anchor" id="var-remove-listener.21"><h3>remove-listener!</h3><div class="usage"><code>(remove-listener! kw)</code></div><div class="doc"><pre class="plaintext">Remove the listener registered with the given keyword.

Returns the keyword.


(pi4clj.gpio/remove-listener! :printer)</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L229">view source</a></div></div><div class="public anchor" id="var-set-hard-pwm-config"><h3>set-hard-pwm-config</h3><div class="usage"><code>(set-hard-pwm-config &amp; {pwm-mode :mode, divisor :clock-divisor, pwm-range :range})</code></div><div class="doc"><pre class="plaintext">Hardware pwm outputs can be modified by 3 options :

    - :mode
    - :clock-divisor
    - :range

These options modify the behavior of all the hardware
pwm outputs.

Two pwm modes are available, modifying how the duty cycle
is modeled (25% in this example) :

    :mark-space
    __      __
      ______  ______

    :balanced (default)
    _   _   _   _
     ___ ___ ___ ___

The pwm clock increments a counter at each pulse. When
this counter hits a value specified by the range, it
resets to 0 and it is equivalent to a period. The range
is therefore the number of pulses per period (default to
1024).

On the Raspberry Pi, the base pwm clock is 19.2MHz

    duty cycle = range / value

In :balanced mode, the frequency varies with the duty cycle.

In :mark-space mode, a higher range results in a better
resolution but a lower frequency as such :

    frequency = 19.2MHz / clock-divisor / range

&lt;!&gt; Doesn't work in :sys setup mode.</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L700">view source</a></div></div><div class="public anchor" id="var-set-pull-resistance"><h3>set-pull-resistance</h3><div class="usage"><code>(set-pull-resistance pin resistance)</code></div><div class="doc"><pre class="plaintext">Set pull resistance to :off
                       :down
                       :up   for the given digital input.

&lt;!&gt; does not work in :sys numbering mode.</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L344">view source</a></div></div><div class="public anchor" id="var-setup-mode"><h3>setup-mode</h3><div class="usage"><code>(setup-mode)</code></div><div class="doc"><pre class="plaintext">Returns * setup mode chosen by the user at start
        * nil if none has been chosen yet

Cf. pi4clj.gpio/start!</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L62">view source</a></div></div><div class="public anchor" id="var-shutdown-monitoring.21"><h3>shutdown-monitoring!</h3><div class="usage"><code>(shutdown-monitoring!)</code></div><div class="doc"><pre class="plaintext">Kill all threads related to pin monitoring.
Useful for a shutdown.

Cf. pi4clj.gpio/monitor-pin!</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L154">view source</a></div></div><div class="public anchor" id="var-start.21"><h3>start!</h3><div class="usage"><code>(start! chosen-mode)</code></div><div class="doc"><pre class="plaintext">Start GPIO activity. Must be called before using GPIOs.

3 setup modes are available:

    :abstract    ;; wiringPi abstracted pin numbering (recommended)
    :gpio        ;; broadcom pin numbering
    :sys         ;; same as :gpio but can be executed without sudo
                    slightly slower but more importantly, pins have to
                    be exported and prepared in advance

Once the mode is set, it can't be changed.

Returns * the given mode
        * another mode if another one has already been set</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L302">view source</a></div></div><div class="public anchor" id="var-stop-soft-pwm"><h3>stop-soft-pwm</h3><div class="usage"><code>(stop-soft-pwm pin)</code></div><div class="doc"><pre class="plaintext">Stop using the given pin as a software pwm output
and kill the related thread.

Cf. pi4clj.gpio/as-soft-pwm-out</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L647">view source</a></div></div><div class="public anchor" id="var-stop-soft-tone"><h3>stop-soft-tone</h3><div class="usage"><code>(stop-soft-tone pin)</code></div><div class="doc"><pre class="plaintext">Stop using the given pin as a software tone output
and kill the related thread.

Cf. pi4clj.gpio/as-soft-tone-out</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L686">view source</a></div></div><div class="public anchor" id="var-toggle"><h3>toggle</h3><div class="usage"><code>(toggle pin)</code></div><div class="doc"><pre class="plaintext">Toggle a digital output and returns the new state
</pre></div><div class="src-link"><a href="https://github.com/dvlopt/pi4clj/blob/0.0.0-alpha1/src/pi4clj/gpio.clj#L425">view source</a></div></div></div></body></html>